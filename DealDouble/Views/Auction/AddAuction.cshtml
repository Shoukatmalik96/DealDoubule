
@{
    ViewBag.Title = "AddAuction";
}



<div class="modal-content">
    <div class="modal-header">
        <h5 class="modal-title" id="exampleModalLabel">Create Auction </h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
        </button>
    </div>
    <form id="AuctionFrom" method="post">
        <div class="modal-body">
            <div class="form-group">
                <label>Title</label>
                <input type="text" class="form-control" name="Title">
            </div>
            <div class="form-group">
                <label>Select Picture</label>
                <input id="auctionPictures" class="form-control" name="PictureURL" type="file" />
                <div id="picturesArea" class="mt-2"></div>
                <input type="hidden" name="AuctionPictures" id="pictureIDs" />
            </div>
            <div class="form-group">
                <label>Description</label>
                <input type="text" class="form-control" name="Description">
            </div>
            <div class="form-group">
                <label>ActualAmount</label>
                <input type="text" class="form-control" name="ActualAmount">
            </div>
            <div class="form-group">
                <label>StartingTime</label>
                <input type="date" class="form-control" name="StartingDate">
            </div>
            <div class="form-group">
                <label>EndingTime</label>
                <input type="date" class="form-control" name="EndingDate">
            </div>

            <div id="imageTemplate" style="display:none">
                <img class='image  img-fluid' src='' />
            </div>
        </div>
        <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
            <button type="button" id="saveBtn" class="btn btn-primary"><i class="far fa-save"></i> Save changes</button>
        </div>
    </form>
</div>


<script>

    $("#auctionPictures").change(function () {
        debugger;
		var pictures = this.files;
        var picsData = new FormData();
        picsData.append("Picture", pictures[0]);
        UploadFiles(picsData);

    });

    function UploadFiles(picsData) {
        $.ajax({
            url: "@Url.Action("UploadImage", "Shared")",
            type: "post",
            data: picsData,
            dateType: "json",
            processData: false,
            contentType: false
        })
            .done(function (responses) {

                AttachNewImage(responses[0].pictureURL, responses[0].ID);
            })
                .fail(function () {
                    alert("Upload Failed ! ");
                });
    }

    function AttachNewImage(imageURL, imageID) {

        var $newimgHTML = $("#imageTemplate").clone();
        $newimgHTML.find(".image").attr("src", "/content/images/" + imageURL);
        $newimgHTML.find(".image").attr("data-id", imageID);
        $("#picturesArea").append($newimgHTML.html());

        //$("#auctionPictures").attr("src", imageURL);

        RemoveImagesOnClick();
    }

    function RemoveImagesOnClick() {
        $("#picturesArea .image").click(function () {
            $(this).remove();
        });
    }

    $("#saveBtn").click(function () {

        $.ajax({
            method: "POST",
            url: "@Url.Action("AddAuction","Auction")",
            data: $("#AuctionFrom").serialize()
        })
            .done(function (response) {
                $("#listingArea").html(response);
                window.location.reload();
            });
    })
</script>